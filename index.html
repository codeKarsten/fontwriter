<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FontWriter</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Calibri, Arial, sans-serif;
        }

        #outputCanvas {
            display: block;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div>
        <label for="textInput">Text Input:</label><br>
        <textarea id="textInput" rows="10" cols="120">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</textarea><br><br>
        <label for="imageInput">Select Input Image:</label><br>
        <input type="file" id="imageInput" accept="image/*"><br>
        <img id="inputImage" src="letters.png" alt="Input Image" style="display:block;"><br><br>
        <label for="letterInput">Letters:</label><br>
        <input type="text" id="letterInput"
            value="ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜabcdefghijklmnopqrstuvwxyzäöü0123456789.,-„“!?"><br><br>
    </div>
    <div>
        <button onclick="generateImage()">Generate Image</button>
    </div>
    <div>
        <canvas id="outputCanvas"></canvas>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const textInput = document.getElementById('textInput');
            const imageInput = document.getElementById('imageInput');
            const inputImage = document.getElementById('inputImage');
            const letterInput = document.getElementById('letterInput');
            const canvas = document.getElementById('outputCanvas');
            const context = canvas.getContext('2d');

            // Set the default image on page load
            inputImage.src = "letters.png";

            imageInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    inputImage.src = e.target.result;
                    inputImage.style.display = 'block';
                };

                reader.readAsDataURL(file);
            });

            function generateImage() {
                const text = textInput.value;
                const letterInputValue = letterInput.value;
                const letterWidth = inputImage.width / letterInputValue.length;
                const letterHeight = inputImage.height;
                const lines = text.split('\n');
                let maxWidth = 0;

                lines.forEach(function(line) {
                    maxWidth = Math.max(maxWidth, line.length);
                });

                canvas.width = maxWidth * letterWidth;
                canvas.height = lines.length * letterHeight;
                context.clearRect(0, 0, canvas.width, canvas.height);

                lines.forEach(function (line, index) {
                    let pos = 0;
                    for (let i = 0; i < line.length; i++) {
                        const char = line.charAt(i);
                        const charIndex = getCharIndex(char, letterInputValue);
                        if (char === ' ' || charIndex !== -1) {
                            context.drawImage(inputImage, charIndex * letterWidth, 0, letterWidth, letterHeight, pos * letterWidth, index * letterHeight, letterWidth, letterHeight);
                        }
                        pos++;
                    }
                });

                canvas.style.display = 'block';
            }

            function getCharIndex(char, letterInput) {
                return letterInput.indexOf(char);
            }

            window.generateImage = generateImage; // Make the function accessible globally
        });
    </script>
</body>

</html>
